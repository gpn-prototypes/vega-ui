# Как работает lerna

Lerna смотрит на изменения в git у всех пакетов и [именование коммитов](commits-style.md), в которых менялись пакеты. Именование коммитов проверяется на основе спецификации [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/).

Примеры:

### Вы сделали фикс в пакет, от которого не зависят другие пакеты

-   Есть компонент `@gpn-prototypes/vega-user` версии `v0.1.1`
-   Есть пакет с пакетами `@gpn-prototypes/vega-ui` версии `v1.0.0` — содержит внутри пакет `vega-user`
-   Вы сделали фикс внутри `packages/components/user`
-   Создали коммит `fix(user): поправлен отступ`
-   Создали PR с этими изменениями, его вмержили в `master`

После этого lerna обновит пакеты:

-   `@gpn-prototypes/vega-user@0.1.1` → `0.1.2`: был коммит `fix` без breaking change, значит повышает `patch`
-   `@gpn-prototypes/vega-ui@1.0.0` → `1.0.1`: т.к. внутри пакета с пакетами есть пакет `vega-user` и у него было патч-изменение

### Вы добавили фичу в пакет, от которого зависит другой пакет

-   Есть компонент `@gpn-prototypes/vega-button` версии `v0.1.1`
-   Есть компонент `@gpn-prototypes/vega-modal` версии `v0.2.0`, он использует пакет `vega-button`
-   Есть пакет с пакетами `@gpn-prototypes/vega-ui` версии `v1.0.0`, он содержит внутри пакеты `vega-button` и `vega-modal`
-   Вы добавили новую фичу внутрь `packages/components/button`
-   Создали коммит `feat(button): добавлены новые размеры`
-   Создали PR с этими изменениями, его вмержили в `master`

После этого lerna обновит пакеты:

-   `@gpn-prototypes/vega-button@0.1.1` → `0.2.0`: был коммит `feat` без breaking change, значит повышаем `minor`
-   `@gpn-prototypes/vega-ui@1.0.0` → `1.1.0`: внутри пакета с пакетами есть пакет `vega-button` и у него было минорное изменение
-   `@gpn-prototypes/vega-modal@0.2.0` → `0.2.1`: модалка использует внутри себя `vega-button`, у которой было минорное изменение. Но сама модалка изменяет только патч (!), т.к. нам не пришлось никак менять модалку после изменения в пакете `vega-button`. Значит у модалки не поменялось API и не изменилось ожидаемое внутреннее поведение

Если бы vega-button поменялась бы настолько, что пришлось бы править использование кнопки внутри модалки, то мы бы сделали отдельный коммит с изменением vega-modal и выбрали бы тип коммита `feat`/`fix`.
